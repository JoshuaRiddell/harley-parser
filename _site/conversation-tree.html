<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Conversation Tree</title>
  <meta name="description" content="Type your conversation tree into the top box and see the generated code below. When you are happy with your conversation, use the form at the bottom to submi...">

  <link rel="stylesheet" href="/harley-tools/css/main.css">
  <link rel="canonical" href="http://joshuariddell.github.io/harley-tools/conversation-tree">
  <link rel="alternate" type="application/rss+xml" title="Harlie Development Tools" href="http://joshuariddell.github.io/harley-tools/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/harley-tools/">Harlie Development Tools</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/harley-tools/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Conversation Tree</h1>
    <p class="post-meta"><time datetime="2015-12-17T21:58:03+10:00" itemprop="datePublished">Dec 17, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Type your <code class="highlighter-rouge">conversation tree</code> into the top box and see the generated code below. When you are happy with your conversation, use the form at the bottom to submit to us!</p>

<script type="text/javascript">

var HEADER = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<aiml version=\"1.0\">\n\n<!-- { topic } topic -->\n\n";
var CATEGORY = "<category>\n{ args }\n</category>\n\n";

var CAT_ARGS = [
    "   <pattern> { args } </pattern>\n",
    "   <that> { args } </that>\n",
    "   <template> { args } </template>"
];

var CODE_OUTPUT_CACHE = "";

document.addEventListener("DOMContentLoaded", function() {
    userInput = document.getElementById('userInput');
    codeOutput = document.getElementById('codeOutput');
    topicInput = document.getElementById('topicInput');

    userInput.addEventListener('keyup', updateCode);
    topicInput.addEventListener('keyup', updateCode);

    userInput.addEventListener('keydown', allowTabbing)
    codeOutput.addEventListener('keydown', allowTabbing)

    updateCode();
});

var allowTabbing = function(e) {
	// allow the user to tab indent in text areas.
	if (e.keyCode == 9 || e.which == 9) {
		e.preventDefault();
		var start = this.selectionStart;
		this.value = this.value.substring(0,this.selectionStart) +
					 "\t" +
					 this.value.substring(this.selectionEnd);
		this.selectionEnd = start + 1;
	}
}

var updateCode = function() {
	console.log("updated");
	var lineList = userInput.value.split("\n")
	for (var i=0; i < lineList.length; i++) {
		if (lineList[i].trim() == "") {
			lineList.splice(i, 1);
			i--;
		}
	}

	var topic = topicInput.value;
	if (!topic) {
		topic = "topicName"
	}
	CODE_OUTPUT_CACHE = HEADER.replace("{ topic }", topic);

	var initialStatement = lineList.splice(0, 1)[0];
	makeCategory()
	makeAiml(initialStatement, lineList);
	codeOutput.value = CODE_OUTPUT_CACHE;
}

var makeAiml = function(that, lineList) {
	var last = lineList.length;
	console.log(lineList);
	if (last >= 2) {
		console.log("executed");
		var pattern = lineList[0].trim();
		var template = lineList[1].trim();

		CODE_OUTPUT_CACHE += makeCategory(pattern, that, template);

		var space = getIndent(lineList[0]);
		for (var i=2; i < lineList.length; i++) {
			if (space == getIndent(lineList[i])) {
				last = i;
			}
		}
		lineList.splice(0, 2);
		makeAiml(template, lineList.splice(0, last + 1));
		return makeAiml(that, lineList)
	}
}

var getIndent = function(string) {
	return string.length - string.replace(/^\s+/, "").length;
}

var makeCategory = function(pattern, that, template) {
	var category = CATEGORY;
	args = "";

	var argList = [pattern, that, template];
	for (var i=0; i < argList.length; i++) {
		if (!argList[i] == "") {
			args += CAT_ARGS[i].replace("{ args }", argList[i].trim())
		}
	}
	category = category.replace("{ args }", args);
	return category
}

function inputFocus(i) {
	if (i.value == i.defaultValue) {
		i.value = "";
		i.style.color = "#000";
	}
}

function inputBlur(i) {
	if (i.value == "") {
		i.value = i.defaultValue;
		i.style.color = "#888";
	}
}

function validateTopic(i) {
	var newVal = i.value.trim();
	newVal = newVal.replace(/\s+[a-z]/g, function(match) {
		return match.trim().toUpperCase();
	});
	newVal = newVal.replace(/\s^/, "");
	i.value = newVal;
}

</script>

<h4> Conversation Tree </h4>

<p><input type="text" class="user-input-blur" id="topicInput" value="Topic Name" onfocus="inputFocus(this)" onblur="inputBlur(this); validateTopic(this)" /></p>

<textarea id="userInput" class="user-input-textarea">What did you get up to last weekend?
	^ already ^
	Sorry, I must have forgotten. <oob>eoc</oob><srai>NEWTOPIC</srai>
	
	DONOTKNOW
	Never mind. <oob>eoc</oob><srai>NEWTOPIC</srai>

	$NO ^
	Oh okay, we can talk about something else. <oob>eoc</oob><srai>NEWTOPIC</srai></textarea>

<h4> AIML Output </h4>

<textarea id="codeOutput" class="user-input-textarea" value=""></textarea>

<h4> Submission </h4>
<p>
This is where the submission form will go.
</p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Harlie Development Tools</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>For feature requests and bug reports, please contact:</li>
          <li><a href="mailto:joshuariddell@gmail.com">joshuariddell@gmail.com</a></li>
          <li>For guidance on how to structure your conversations and to get involved in the harlie project, please contact:
</li>
          <li><a href="mailto:a.campbell@uq.edu.au">a.campbell@uq.edu.au</a></li>
        </ul>
      </div>

  </div>

  <div class="footer-col-wrapper">

    <img class="banner" src="/harley-tools/img/footer-banner.png" alt="Footer Banner Logos">

  </div>

</footer>


  </body>

</html>
